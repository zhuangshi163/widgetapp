<!DOCTYPE html>
<html class="ui-mobile landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
  <head>
    <title>
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/ui-media.css">
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/ui-apple.css"> 
    <link rel="stylesheet" href="css/w_style.css">
    <link rel="stylesheet" href="css/s_style.css">
    <link rel="stylesheet" href="css/style.css"> <script src="js/zy_anim.js">
    </script>
    <script src="js/zy_control.js">
    </script>
 	<script src="js/zy_tmpl.js">
    </script>
     <script type="text/javascript" src="js/config.js"></script>
  </head>
  <body class="ui-mobile-viewport ui_body_d" >
   

<div id="header" data-role="header" class="ui-header ui-bar-a ui-header-fixed ui_title" >
<div onclick="uexWindow.evaluateScript('','0','close1()')" id="fh" ontouchstart="t_m_start(this.id)" ontouchmove="t_m_move(this.id)" ontouchend="t_m_end(this.id)" data-role="button" class="ui-btn-left ui-btn-corner-all ui-btn ui-btn-limit ui-bar-a   ui-shadow w_head_btn"> <span class="ui-btn-inner ui-btn-corner-all www_padding"> <span class="ui-btn-text">è¿”å›</span> </span></div> 

<!-- <div onclick="close1()"  class="ui-btn ui-btn-limit ui-btn-left ui-btn-iphone      "> <div class="ui-btn-apple-nl"><div class="ui-btn-apple-nr"><div class="ui-btn-apple-nc"> <span class="ui-btn-inner "> <span class="ui-btn-text">è¿”å›</span>  </span>  </div></div></div></div>  -->
<h1 id="search_title" class="ui-title" tabindex="0" role="heading" aria-level="1">
æœç´¢ï¼šæ‰‹æœ?
</h1> 
</div>

<div id="page_0" class="ui-page ui-body-d ui-page-active ui_body_a_dwx" tabindex="0">
<div class="ui-content ui-body-d ui-fixed-top ui-fixed-bottom w_content_padding">
<div id="">
<div id="scroller">
<p class="w_result">æœç´¢ï¼?span id="w_goods_name"></span>ï¼Œæœåˆ°å•†å“?span id="num"></span>ä»?/p>
<ul data-role="listview" id="goods_li" class="ui-listview  ui-corner-all  ui-shadow wa">
	
</ul>

</div>
</div>
<p onclick="addMore()" class='more_p' id="more_" style="display:none;height: 3em;"><a href='javascript:(0)'>æ›´å¤š</a></p>
</div>
</div>

<script src="js/main.js"></script>

<script>
	var search_keyword =new Array();
	/*è·å–å‚æ•°*/
	//parseParam();
	var search_result = 0;
	/*if(search_result.length > 5){
		search_result = search_result.substr(0,5) + "...";
	}
	$id("search_title").innerHTML = "æœç´¢ï¼?+search_result;*/
	
	var page = '';
	var pagesize = '';
	var goods_list="";
	
	//zy_init();
    /*é¡µé¢åˆ‡æ¢*/
	function openage(id,goods_name){
			var html_url='goods_details.html?id='+id+'&name='+encodeURIComponent(goods_name);
			openNewWin("goodsDetails",html_url,"2");
		}
	 //ç‚¹å‡»åˆ—è¡¨äº‹ä»¶
	var t_m = false, t_start_x, t_end_x;
    function t_m_start(id){
		$id(id).className = 'w_li_result_click';
        t_m = true;
        t_start_x = e.touches[0].pageX;
    }
    function t_m_move(id){
		$id(id).className = '';
    }

    
    function t_m_end(id){
		$id(id).className = '';
        t_m = false;
    }
    
    //æœç´¢
    function search(page){
    	var w_url= image_url + "plugins/zywx/rpc/goods_list.php?jsoncallback=?&act=search&keyword="+encodeURIComponent(search_result)+"&page="+page+"&page_size=10";
    	uexXmlHttpMgr.open(1, "GET",w_url,"");
    	uexXmlHttpMgr.send(1);
     }  
   
  //è¯»å–æ–‡ä»¶
	function readFile(path,size){
		uexFileMgr.openFile("3",path,1);
		uexFileMgr.readFile("3",size);
		uexFileMgr.closeFile("3");
	}
    //åˆ›å»ºæ–‡ä»¶
	function creatFile(path){
		uexFileMgr.createFile("1",path);
		uexFileMgr.closeFile("1");
	}
	//å†™å…¥æ–‡ä»¶
	function writeFile(path,data){
		uexFileMgr.openFile("2",path,"1");
		uexFileMgr.writeFile("2",0,data);
		uexFileMgr.closeFile("2");
	}
	//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
	function isFileExistByPath(path){
	    uexFileMgr.isFileExistByPath(path);
	}
	zy_fix("header","","",function(){
		/*è·å–å‚æ•°*/
		parseParam();
		search_result = params.search_value;
		uexWindow.evaluateScript('','1','title1(\''+search_result+'\')');
		
		$id("w_goods_name").innerHTML = search_result;
			$id("search_title").innerHTML = search_result;
	    	uexWidgetOne.cbError = function(opcode,errorcode,errorinfo){
	    		uexWindow.alert("æç¤º","errorCode:" + errorCode + "\nerrorInfo:" + errorinfo,"ç¡®å®š");
	    	}
	    	uexXmlHttpMgr.onData = function(opCode,status,result){
	    		if(status == 1){
		    		var res = (result.substr(result.indexOf("?(")+2,result.length)).substr(0,result.length-3);//æˆªå–å­—ç¬¦ä¸²ï¼šå»æ‰ï¼Ÿï¼ˆï¼?
		    		var o = JSON.parse(res);//æŠŠresultçš„ç»“æœè½¬åŒ–ä¸ºjsonå¯¹è±¡
		    		uexXmlHttpMgr.close(opCode);
		    		isFileExistByPath("wgt://data/search/search_result.txt");//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
		    		var num = 0;
                    for (var i in o.goods) {
                        num++;
                        goods_list += '<li onclick="openage(' + o.goods[i].goods_id + ',\'' + o.goods[i].goods_name + '\')" class=" ui-body-d   ui-li-has-thumb    ui-li-static  ui-li sort-li ui-li-font-color">'+
						'<span  class="ui-li-thumb ui-li-thumb3" style="background-image:url(\'' + image_url + o.goods[i].goods_thumb + '\');" ></span>'+
						'<h3 class="ui-li-heading">' + o.goods[i].goods_name + '</h3>'+
						'<p class="ui-li-desc w_fontsize">' + o.goods[i].goods_brief + '</p>'+
						'<p class="ui-li-desc w_fontsize">å¸‚åœºä»·æ ¼ï¼? + o.goods[i].market_price + '</p>'+
						'<p class="ui-li-desc w_fontsize">æœ¬åº—ä»·æ ¼ï¼?span class="w_color">' + o.goods[i].shop_price + '</span></p></li>';
                    }
		    		$id("num").innerHTML = num;
		    		$id("goods_li").innerHTML = goods_list;
		    		
		    		page = o.pager.page;
					pagesize = o.pager.page_count;
					
					if(page < pagesize){
						$id("more_").style.display = "block";
					}else{
						$id("more_").style.display = "none";
					}
	    		}
	    	}
	    	uexFileMgr.cbIsFileExistByPath = function(opCode, dataType, data){
		            if (data == 1) {
		            	readFile("wgt://data/search/search_result.txt",-1);//æ–‡ä»¶å­˜åœ¨ï¼Œç›´æ¥è¯»å?
		            }
		            else {
		            	creatFile("wgt://data/search/search_result.txt");//åˆ›å»ºæ–‡ä»¶å¹¶å†™å…?
		            	var rs = {"search_name":search_result};
		            	search_keyword.push(rs)
		            	writeFile("wgt://data/search/search_result.txt",JSON.stringify(search_keyword));
		            }
	    	}
	    	uexFileMgr.cbReadFile = function(opCode,dataType,data){//è¯»å–æ–‡ä»¶å›è°ƒå‡½æ•°
	    		if(data != ""){
	    			var search_con = JSON.parse(data);
	    			for(var i=0; i<search_con.length; i++){
	    				if(search_result == search_con[i].search_name){//åˆ¤æ–­æœç´¢çš„å…³é”®å­—åœ¨æ–‡ä»¶ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è·³å‡ºå¾ªç?
	    					return;
	    				}
	    			}
	    			var rs1 = {"search_name":search_result};//æ–‡ä»¶ä¸­æ²¡æœ‰è¯¥å…³é”®å­—ï¼Œå†™å…¥
					search_con.push(rs1)
	            	writeFile("wgt://data/search/search_result.txt",JSON.stringify(search_con));
	    		}
	    	}
	    	search('1');
	});
	 /*window.uexOnload = function(){
	 		$id("w_goods_name").innerHTML = search_result;
			$id("search_title").innerHTML = search_result;
	    	uexWidgetOne.cbError = function(opcode,errorcode,errorinfo){
	    		uexWindow.alert("æç¤º","errorCode:" + errorCode + "\nerrorInfo:" + errorinfo,"ç¡®å®š");
	    	}
	    	uexXmlHttpMgr.onData = function(opCode,status,result){
	    		if(status == 1){
		    		var res = (result.substr(result.indexOf("?(")+2,result.length)).substr(0,result.length-3);//æˆªå–å­—ç¬¦ä¸²ï¼šå»æ‰ï¼Ÿï¼ˆï¼?
		    		var o = JSON.parse(res);//æŠŠresultçš„ç»“æœè½¬åŒ–ä¸ºjsonå¯¹è±¡
		    		uexXmlHttpMgr.close(opCode);
		    		isFileExistByPath("wgt://data/search/search_result.txt");//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
		    		var goods_list="";
		    		var num = 0;
		    		for(var i in o.goods){
		    			num++;
		    			goods_list += '<li onclick="openage('+o.goods[i].goods_id+',\''+o.goods[i].goods_name+'\')" class=" ui-body-d   ui-li-has-thumb    ui-li-static  ui-li sort-li ui-li-font-color"><span  class="ui-li-thumb ui-li-thumb3" style="background-image:url(\''+image_url+o.goods[i].goods_thumb+'\');" ></span>    <h3 class="ui-li-heading">'+o.goods[i].goods_name+'</h3>    <p class="ui-li-desc w_fontsize">'+o.goods[i].goods_brief+'</p> <p class="ui-li-desc w_fontsize">å¸‚åœºä»·æ ¼ï¼?+o.goods[i].market_price+'</p> <p class="ui-li-desc w_fontsize">æœ¬åº—ä»·æ ¼ï¼?span class="w_color">'+o.goods[i].shop_price+'</span></p>       </li>';
		    			}
		    		$id("num").innerHTML = num;
		    		$id("goods_li").innerHTML = goods_list;
	    		}
	    	}
	    	uexFileMgr.cbIsFileExistByPath = function(opCode, dataType, data){
		            if (data == 1) {
		            	readFile("wgt://data/search/search_result.txt",-1);//æ–‡ä»¶å­˜åœ¨ï¼Œç›´æ¥è¯»å?
		            }
		            else {
		            	creatFile("wgt://data/search/search_result.txt");//åˆ›å»ºæ–‡ä»¶å¹¶å†™å…?
		            	var rs = {"search_name":search_result};
		            	search_keyword.push(rs)
		            	writeFile("wgt://data/search/search_result.txt",JSON.stringify(search_keyword));
		            }
	    	}
	    	uexFileMgr.cbReadFile = function(opCode,dataType,data){//è¯»å–æ–‡ä»¶å›è°ƒå‡½æ•°
	    		if(data != ""){
	    			var search_con = JSON.parse(data);
	    			for(var i=0; i<search_con.length; i++){
	    				if(search_result == search_con[i].search_name){//åˆ¤æ–­æœç´¢çš„å…³é”®å­—åœ¨æ–‡ä»¶ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è·³å‡ºå¾ªç?
	    					return;
	    				}
	    			}
	    			var rs1 = {"search_name":search_result};//æ–‡ä»¶ä¸­æ²¡æœ‰è¯¥å…³é”®å­—ï¼Œå†™å…¥
					search_con.push(rs1)
	            	writeFile("wgt://data/search/search_result.txt",JSON.stringify(search_con));
	    		}
	    	}
	    	search();
	    	
	     }*/
		 function close1(){
		 	uexWindow.evaluateScript('root','0','getSearchValue()');
			uexWindow.close("-1");
		 }
	   //æ·»åŠ æ›´å¤š
		function addMore(){
			var current_page = parseInt(page)+1;
			if(current_page > pagesize){
				current_page = pagesize;
			}
			search(current_page);
		}
		
  </script>

  </body>
  <script>
	zy_init();
</script>
</html>
